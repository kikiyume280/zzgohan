<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>クリックでごはんゲーム</title>
<style>
 body{margin:0;font-family:sans-serif;background:#f5f5f5;text-align:center;}
 .screen{display:none;padding-top:40px;}
 .active{display:block;}
 button{padding:12px 24px;font-size:20px;border:none;border-radius:10px;background:#ff7f7f;color:#fff;cursor:pointer;margin:10px;}
 #videoArea{position:relative;width:320px;height:320px;margin:0 auto;background:#ddd;overflow:hidden;border-radius:12px;}
 .feedVideo{position:absolute;width:100%;height:auto;pointer-events:none;}
 #scoreText{font-size:24px;margin:10px;}
 #rankList{margin-top:20px;font-size:20px;}
</style>
</head>
<body>

<!-- ホーム画面 -->
<div id="home" class="screen active">
  <h1>ごはんゲーム</h1>
  <button onclick="goStart()">スタート</button>
  <button onclick="goRank()">ランキング</button>
</div>

<!-- ゲーム画面 -->
<div id="game" class="screen">
  <h2>画面をクリック！</h2>
  <div id="scoreText">スコア：0</div>
  <div id="videoArea" onclick="clickFeed()"></div>
  <div id="timerText" style="font-size:22px;margin-top:10px;">30</div>
</div>

<!-- 結果画面 -->
<div id="result" class="screen">
  <h2>結果</h2>
  <div id="finalScore" style="font-size:26px;margin:10px;"></div>
  <input id="playerName" placeholder="名前" style="padding:8px;font-size:18px;" />
  <br>
  <button onclick="saveRank()">登録</button>
  <button onclick="goHome()">ホームへ</button>
</div>

<!-- ランキング画面 -->
<div id="ranking" class="screen">
  <h2>ランキング(上位10名)</h2>
  <div id="rankList"></div>
  <button onclick="goHome()">ホーム</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
// ▼▼▼ Firebase設定（あなたのキーに書き換えてください） ▼▼▼
// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC7QhPPA1_AnLlxtVsIwnT-fKtaaHE-f5U",
  authDomain: "zzgohan-cd010.firebaseapp.com",
  projectId: "zzgohan-cd010",
  storageBucket: "zzgohan-cd010.firebasestorage.app",
  messagingSenderId: "937989734738",
  appId: "1:937989734738:web:5077ac43e2c21647ae7a8b",
  measurementId: "G-2ETHBKGMH3"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
// ▲▲▲ ここまで書き換え ▲▲▲

let score = 0;
let timeLeft = 30;
let timer;

function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goStart(){
  score = 0;
  timeLeft = 30;
  document.getElementById('scoreText').textContent = 'スコア：0';
  document.getElementById('timerText').textContent = 30;
  showScreen('game');
  timer = setInterval(()=>{
    timeLeft--;
    document.getElementById('timerText').textContent = timeLeft;
    if(timeLeft <= 0){ endGame(); }
  },1000);
}

function clickFeed(){
  if(timeLeft <= 0) return;
  score += 10;
  document.getElementById('scoreText').textContent = 'スコア：'+score;

  const v = document.createElement('img');
  v.src = 'https://dummyimage.com/200x200/ffffff/000000.png&text=feed';
  v.className = 'feedVideo';
  v.style.bottom = '-50px';
  document.getElementById('videoArea').appendChild(v);

  let pos = -50;
  const anim = setInterval(()=>{
    pos += 5;
    v.style.bottom = pos + 'px';
    if(pos > 350){
      clearInterval(anim);
      v.remove();
    }
  },30);
}

function endGame(){
  clearInterval(timer);
  document.getElementById('finalScore').textContent = '最終スコア：'+score;
  showScreen('result');
}

// ▼ Firebaseへ保存
async function saveRank(){
  const name = document.getElementById('playerName').value || '名無し';

  await db.collection("ranking").add({
    name: name,
    score: score,
    time: Date.now()
  });

  goRank();
}

// ▼ Firebaseから取得
async function goRank(){
  const box = document.getElementById('rankList');
  box.innerHTML = '';

  const snapshot = await db.collection("ranking")
    .orderBy("score", "desc")
    .limit(10)
    .get();

  let i = 1;
  snapshot.forEach(doc => {
    const r = doc.data();
    box.innerHTML += `${i}位：${r.name} - ${r.score}<br>`;
    i++;
  });

  showScreen('ranking');
}

function goHome(){ showScreen('home'); }
</script>

</body>
</html>
