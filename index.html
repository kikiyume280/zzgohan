<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ãƒ¦ãƒ¡é¤Œä»˜ã‘å¤§ä½œæˆ¦ï¼</title>
  <style>
    body { font-family: sans-serif; text-align:center; background:#f1f5f9; margin:0; }
    #gameArea { position: relative; width:100%; height:60vh; background:#fff; overflow:hidden; margin-top:20px; }
    .floatingVideo {
      position:absolute;
      left:50%; transform:translateX(-50%);
      width:200px; pointer-events:none;
    }
    button {
      padding:12px 30px; margin:10px;
      font-size:18px; border-radius:8px; border:none;
      background:#4f46e5; color:white;
    }
    #rankingList { text-align:left; width:260px; margin:0 auto; }

/* â˜… ãƒ›ãƒ¼ãƒ ã®ã¨ãã ã‘ howto ã‚’è¡¨ç¤ºã™ã‚‹ */
#howto {
  display: block;
}

/* â˜… ãƒ›ãƒ¼ãƒ ä»¥å¤–ã§ã¯èª¬æ˜æ–‡ã¨éŸ³é‡è¨­å®šã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
body:not(.home-active) #howto,
body:not(.home-active) #soundSettings {
  display: none;
}
  </style>
</head>
<body>

<h1 id="title">ãƒ¦ãƒ¡é¤Œä»˜ã‘å¤§ä½œæˆ¦!  !</h1>


<!-- â˜… ãƒ›ãƒ¼ãƒ å°‚ç”¨ã®èª¬æ˜æ–‡ â˜… -->
<div id="homeHowto" style="margin-top:20px; font-size:16px; line-height:1.6;">
  <h3>ã€éŠã³æ–¹ã€‘</h3>
  ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚³ã‚¢ã‚’ã‚¢ãƒƒãƒ—!!<br>
  ã‚ªãƒ ãƒ©ã‚¤ã‚¹ â‡’ 10ãƒã‚¤ãƒ³ãƒˆ<br>
  ã‚ªãƒ ãƒ©ã‚¤ã‚¹ï¼ˆãƒ¬ã‚¢ï¼‰ â‡’ 1000ãƒã‚¤ãƒ³ãƒˆ (10%)<br>
  â€»ã‚„ã‚Šç›´ã—ç­‰ã¯ã‚µã‚¤ãƒˆã‚’ãƒªãƒ­ãƒ¼ãƒ‰<br><br>

  <h3>ã€ãƒ«ãƒ¼ãƒ«ã€‘</h3>
  ãƒ„ãƒ¼ãƒ«ã€æ©Ÿæ¢°ã€ã‚­ãƒ¼å‰²ã‚Šå½“ã¦å¤‰æ›´ãªã©ã¯ä½¿ã‚ãªã„ã“ã¨<br>
  â€»ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»ç”»é¢ã‚¯ãƒªãƒƒã‚¯ã®ã¿
</div>


  
<!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
<div id="home">
  <button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <button onclick="showRanking()">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€è¦§</button>
</div>

  <div id="howto" style="margin-top:20px; font-size:16px; line-height:1.6;">
  <h3>ã€éŠã³æ–¹ã€‘</h3>
  ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚³ã‚¢ã‚’ã‚¢ãƒƒãƒ—!!<br>
  ã‚ªãƒ ãƒ©ã‚¤ã‚¹ â‡’ 10ãƒã‚¤ãƒ³ãƒˆ<br>
  ã‚ªãƒ ãƒ©ã‚¤ã‚¹ï¼ˆãƒ¬ã‚¢ï¼‰ â‡’ 1000ãƒã‚¤ãƒ³ãƒˆ (10%)<br>
  â€»ã‚„ã‚Šç›´ã—ç­‰ã¯ã‚µã‚¤ãƒˆã‚’ãƒªãƒ­ãƒ¼ãƒ‰<br><br>

  <h3>ã€ãƒ«ãƒ¼ãƒ«ã€‘</h3>
  ãƒ„ãƒ¼ãƒ«ã€æ©Ÿæ¢°ã€ã‚­ãƒ¼å‰²ã‚Šå½“ã¦å¤‰æ›´ãªã©ã¯ä½¿ã‚ãªã„ã“ã¨<br>
  â€»ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ãƒ»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»ç”»é¢ã‚¯ãƒªãƒƒã‚¯ã®ã¿
</div>

  <div id="soundSettings" style="margin-top:20px; text-align:center;">
  <h3>BGMå†ç”Ÿãƒœã‚¿ãƒ³</h3>
  <div>
    BGM éŸ³é‡ï¼š
    <input type="range" id="bgmVolume" min="0" max="1" step="0.01">
  </div>
  <div style="margin-top:10px;">
    ã‚¯ãƒªãƒƒã‚¯ éŸ³é‡ï¼š
    <input type="range" id="seVolume" min="0" max="1" step="0.01">
  </div>
</div>


<!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
<div id="game" style="display:none;">
  <div>ã‚¹ã‚³ã‚¢ï¼š<span id="score">0</span></div>
  <div id="timer">30</div>
  <div id="gameArea">ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼</div>
</div>

<!-- çµæœç”»é¢ -->
<div id="result" style="display:none;">
  <h2>æœ€çµ‚ã‚¹ã‚³ã‚¢ï¼š<span id="finalScore"></span></h2>
  <input id="playerName" placeholder="åå‰" style="padding:10px;font-size:16px;">
  <br>
  <button onclick="registerScore()">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²</button>
</div>

<!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»é¢ -->
<div id="ranking" style="display:none;">
  <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP10</h2>
  <div id="rankingList"></div>
  <button onclick="goHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

  // âš  ã“ã“ã¯ã‚ãªãŸã® Firebase ã®è¨­å®šã«æ›¸ãæ›ãˆã¦ãã ã•ã„
const firebaseConfig = {
  apiKey: "AIzaSyCC7KAv7V4j1Z6-o1Y8ikmb3r5htN9O_aA",
  authDomain: "zzgohan-280.firebaseapp.com",
  databaseURL: "https://zzgohan-280-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "zzgohan-280",
  storageBucket: "zzgohan-280.firebasestorage.app",
  messagingSenderId: "459336048542",
  appId: "1:459336048542:web:ff6c825dec81cc7df8008f",
  measurementId: "G-JX4RP9LWR3"
};

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let score = 0;
  let timeLeft = 30;
  let timerID;

  // ãƒ›ãƒ¼ãƒ  â†’ ã‚²ãƒ¼ãƒ é–‹å§‹
  window.startGame = function(){
    score = 0;
    timeLeft = 30;
    document.getElementById("score").textContent = score;

    show("home", false);
    show("ranking", false);
    show("result", false);
    show("game", true);

    timerID = setInterval(() => {
      timeLeft--;
      document.getElementById("timer").textContent = timeLeft;
      if(timeLeft <= 0) endGame();
    }, 1000);
  }

  // ã‚²ãƒ¼ãƒ çµ‚äº† â†’ çµæœç”»é¢
  function endGame(){
    clearInterval(timerID);
    show("game", false);
    document.getElementById("finalScore").textContent = score;
    show("result", true);
  }

  // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²
  window.registerScore = function(){
    const name = document.getElementById("playerName").value.trim();
    if(!name) return alert("åå‰ã‚’å…¥ã‚Œã¦ã­");

    const rankRef = ref(db, "ranking");

    // ã¾ãšä»Šã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’å–å¾—ã—ã¦é‡è¤‡é™¤å»
    onValue(rankRef, (snapshot) => {
      let data = snapshot.val() || {};
      for (let key in data) {
        if(data[key].name === name && data[key].score === score){
          // æ—¢ã«åŒã˜ã‚‚ã®ãŒã‚ã‚‹ â†’ æ¶ˆã™
          set(ref(db, "ranking/" + key), null);
        }
      }

      // å†åº¦ç™»éŒ²
      push(rankRef, {
        name: name,
        score: score
      });

      goHome();
    }, { onlyOnce:true });
  }

  // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
  window.showRanking = function(){
    const rankRef = ref(db, "ranking");

    onValue(rankRef, (snapshot) => {
      let list = snapshot.val() || {};
      let arr = Object.values(list);

      // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
      arr.sort((a,b)=>b.score - a.score);

      // 10ä½ã¾ã§
      arr = arr.slice(0,10);

      let html = "";
      arr.forEach((r,i)=>{
        html += (i+1)+". "+r.name+" - "+r.score+"<br>";
      });
      document.getElementById("rankingList").innerHTML = html;
    });

    show("home", false);
    show("result", false);
    show("game", false);
    show("ranking", true);
  }

document.getElementById("gameArea").addEventListener("click", () => {
  if(timeLeft <= 0) return;

  // â˜…ã‚¯ãƒªãƒƒã‚¯éŸ³
playClickSound();


  score += 10;
  document.getElementById("score").textContent = score;

  spawnVideo();
});


function spawnVideo(){
  const img = document.createElement("img");

  // 10%ã§ãƒ¬ã‚¢
  const isRare = Math.random() < 0.10;

  const normalGif = "https://raw.githubusercontent.com/kikiyume280/zzgohan/main/food.gif";
  const rareGif   = "https://raw.githubusercontent.com/kikiyume280/zzgohan/main/food_rare.gif";

  img.src = (isRare ? rareGif : normalGif) + "?" + Date.now();

  img.className = "floatingVideo";

  // ä¸­å¤®
  img.style.top = "50%";
  img.style.left = "50%";
  img.style.transform = "translate(-50%, -50%)";

  // â˜… å…¨GIFã‚µã‚¤ã‚ºçµ±ä¸€
  img.style.width = "300px";  
  img.style.height = "auto";

  document.getElementById("gameArea").appendChild(img);

  // ã‚¹ã‚³ã‚¢åŠ ç®—
  if(isRare){
    score += 1000;
  } else {
    score += 10;
  }
  document.getElementById("score").textContent = score;

  // ä¸€å®šæ™‚é–“ã§æ¶ˆã™
  setTimeout(() => {
    img.remove();
  }, isRare ? 700 : 600);
}

  // æ±ç”¨è¡¨ç¤ºåˆ‡æ›¿
// ã‚‚ã¨ã‚‚ã¨ã® show ã‚’ window ã«ç™»éŒ²
window.show = function(id, bool){
  document.getElementById(id).style.display = bool ? "block" : "none";
   toggleHowto(); // â† â˜… ã“ã‚Œã‚’è¿½åŠ ï¼
};

  window.goHome = function(){
    show("result", false);
    show("ranking", false);
    show("game", false);
    show("home", true);
  }
</script>

<!-- â˜… ãƒ›ãƒ¼ãƒ é™å®šBGM + éŸ³é‡è¨­å®š â˜… -->
<script>
let bgm = new Audio("https://raw.githubusercontent.com/kikiyume280/zzgohan/main/vinly.mp3");
bgm.loop = true;
bgm.volume = 0.5;

// ã‚¯ãƒªãƒƒã‚¯éŸ³ã‚’éŸ³é‡å¯å¤‰ã«ã™ã‚‹ãŸã‚ä¿å­˜
let clickSoundURL = "https://raw.githubusercontent.com/kikiyume280/zzgohan/main/pon.mp3";

// â–¼ ã‚¯ãƒªãƒƒã‚¯éŸ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
let clickSound = new Audio(clickSoundURL);

// â–¼ ä¿å­˜ã•ã‚ŒãŸéŸ³é‡ï¼ˆãªã‘ã‚Œã°0.5ï¼‰
const savedBgmVol = localStorage.getItem("bgmVolume") ?? 0.5;
const savedSeVol  = localStorage.getItem("seVolume") ?? 0.5;

// â–¼ åˆæœŸéŸ³é‡ã‚»ãƒƒãƒˆ
bgm.volume = savedBgmVol;
clickSound.volume = savedSeVol;

// â–¼ UI ã«ã‚‚åæ˜ 
document.getElementById("bgmVolume").value = savedBgmVol;
document.getElementById("seVolume").value  = savedSeVol;

// â–¼ BGM éŸ³é‡å¤‰æ›´
document.getElementById("bgmVolume").addEventListener("input", e=>{
  const v = e.target.value;
  bgm.volume = v;
  localStorage.setItem("bgmVolume", v);
});

// â–¼ SE éŸ³é‡å¤‰æ›´
document.getElementById("seVolume").addEventListener("input", e=>{
  const v = e.target.value;
  clickSound.volume = v;
  localStorage.setItem("seVolume", v);
});

  
function playClickSound(){
  clickSound.currentTime = 0;
  clickSound.play().catch(()=>{});
}

// â–¼ ã‚ªãƒªã‚¸ãƒŠãƒ« show ã‚’ä¿å­˜
const _oldShow = window.show;

// â–¼ ãƒ›ãƒ¼ãƒ ã ã‘èª¬æ˜æ–‡ã¨BGMã‚’åˆ¶å¾¡ã™ã‚‹ show()
window.show = function(id, bool){
  _oldShow(id, bool);

 // â–¼ ãƒ›ãƒ¼ãƒ ãŒå®Ÿéš›ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ­£ç¢ºã«åˆ¤å®š
const homeVisible =
  window.getComputedStyle(document.getElementById("home")).display !== "none";


  // â˜… ãƒ›ãƒ¼ãƒ æ™‚ã®ã¿èª¬æ˜æ–‡ã¨éŸ³é‡è¨­å®šã‚’è¡¨ç¤º
  document.body.classList.toggle("home-active", homeVisible);

  // â˜… ãƒ›ãƒ¼ãƒ æ™‚ã ã‘ BGM å†ç”Ÿ
  if(homeVisible){
    bgm.play().catch(()=>{});
  } else {
    bgm.pause();
    bgm.currentTime = 0;
  }
};

// â˜… éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIã‚’ãƒšãƒ¼ã‚¸ä¸‹ã«è¿½åŠ 
window.addEventListener("DOMContentLoaded", () => {
  const box = document.createElement("div");
  box.style.marginTop = "20px";
  box.innerHTML = `
    <div style="margin-top:30px;">
      <b>ğŸ”Š å…¨ä½“éŸ³é‡</b><br>
      <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.5" style="width:200px;">
    </div>
  `;
  document.body.appendChild(box);

  document.getElementById("volumeSlider").addEventListener("input", (e)=>{
    bgm.volume = e.target.value;
  });
});

// â˜… æœ€åˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ BGM ã‚’è¨±å¯
window.addEventListener("click", () => {
  if(bgm.paused){
    bgm.play().catch(()=>{});
  }
}, { once:true });


</script> <!-- â˜… ã“ã“ã§ Firebase ã€œ BGM ã¾ã§ã®å¤§ããª script ã¯çµ‚äº† -->

<!-- â˜… toggleHowto() ã‚’å…¥ã‚Œã‚‹å ´æ‰€ï¼ˆã“ã“ãŒæ­£è§£ã®ä½ç½®ï¼‰ -->
<script>
function toggleHowto(){
  const home = document.getElementById("home");
  const howto = document.getElementById("homeHowto");

  if (home.style.display !== "none") {
    howto.style.display = "block";   // ãƒ›ãƒ¼ãƒ ã®ã¨ãã ã‘è¡¨ç¤º
  } else {
    howto.style.display = "none";    // ãã‚Œä»¥å¤–ã¯æ¶ˆã™
  }
}
</script>

</body>
</html>

